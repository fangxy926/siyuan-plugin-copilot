# 多模型右键菜单功能测试指南

## 测试场景

### 场景1：当前多模型响应 - 卡片布局

1. **启动多模型问答**
   - 在AI Sidebar中选择"问答"模式
   - 启用多模型对话功能
   - 选择2个或更多模型
   - 发送一个问题

2. **测试右键菜单（有选中文本）**
   - 在任意模型的回答内容中选中一段文本
   - 右键点击选中的文本
   - 应该看到三个复制选项：
     - 复制（Markdown，默认）
     - 复制（纯文本）
     - 复制（富文本）
   - 分别测试每个选项，验证复制的内容格式是否正确

3. **测试右键菜单（无选中文本）**
   - 在模型回答区域右键点击（不选中任何文本）
   - 应该看到常规消息菜单：
     - 复制消息
     - 编辑消息
     - 删除消息
     - 保存到笔记
     - 重新生成

### 场景2：当前多模型响应 - 标签页布局

1. **切换到标签页布局**
   - 在多模型响应区域点击"标签页"布局按钮
   
2. **重复场景1的测试步骤**
   - 测试有选中文本的右键菜单
   - 测试无选中文本的右键菜单

### 场景3：历史消息中的多模型响应

1. **选择一个答案**
   - 在多模型响应中点击"选择此答案"按钮
   - 消息会被保存到历史记录中

2. **测试历史消息的右键菜单**
   - 向上滚动查看刚才保存的多模型响应
   - 在历史消息的模型回答中选中文本
   - 右键点击，验证菜单功能
   - 测试无选中文本的右键菜单

## 预期结果

### 复制格式验证

1. **Markdown格式**
   - 代码块应保持 \`\`\` 格式
   - 链接应保持 [text](url) 格式
   - 列表应保持 - 或 1. 格式
   - 标题应保持 # 格式

2. **纯文本格式**
   - 所有格式标记被移除
   - 只保留纯文本内容

3. **富文本格式**
   - 粘贴到富文本编辑器（如Word）时保持格式
   - 代码块有语法高亮
   - 链接可点击

## 常见问题排查

### 问题1：右键菜单不显示
- 检查是否在正确的内容区域右键
- 确认浏览器没有拦截右键菜单

### 问题2：复制功能不工作
- 检查浏览器的剪贴板权限
- 确认选中了文本（对于选中文本复制）

### 问题3：Markdown转换不正确
- 检查Lute库是否正确加载
- 查看浏览器控制台是否有错误信息

## 开发调试

如果需要调试，可以在浏览器控制台中：

```javascript
// 检查选中状态
console.log('Selection in message:', selectionInMessage);
console.log('Selection text:', selectionText);
console.log('Selection HTML:', selectionHtml);

// 检查Lute库
console.log('Lute available:', !!window.Lute);
```

## 注意事项

1. 多模型响应在未选择答案前，messageIndex 为 -1
2. 历史消息中的多模型响应使用实际的 messageIndex
3. 右键菜单会根据是否有选中文本自动切换显示内容
4. 复制操作需要浏览器的剪贴板权限
